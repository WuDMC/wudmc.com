{% extends "base.html" %}
{% load static %}
{% load my_custom %}

{% block page_content %}
<body style="background-color: #1a1a1a;color: rgb(247,249,250);">
    <div class="container-fluid px-0" id="main-content">
        <div class="row no-gutters">
            <div class="col-12 col-sm-6 offset-sm-0 p-relative">
            <div class="maps" id="map">

            </div>
            <button class="btn btn-light p-absolute" style="display:none" type="button" id="google_button">Open in Google Maps
                <a id="mapLink" href="#" title="Open in Google Maps" target="_blank"></a>
            </button>
            <div id="geo_results" class="p-absolute" style="display:none">
                <div id="geo_details">
                    <p class="text-left main-text fl-yellow">During this journey you will cover <span id="total"></span> and make <span id="result" >{{ result|safe }} </span> stops at:</p>
                    <div id="stoplist" >{{ result|safe }}</div>
                    <div id="right-panel" style="display:none; background-color: #92a8d1"></div>
                </div>
            </div>
            <!--                <div class="pic" id="map"></div>-->
            </div>
            <div class="col-12 col-sm-6 col-md-6 right-col" style="justify-content: center;">
                <div class="text-left mx-auto" style="width: 80%;">
                    <h1 class="fl-yellow" style="font-family: 'Roboto Mono', monospace;width: 90%;padding-top: 25px; font-size: 26px;">Hey, just enter your</h1>
                    <h2>STARTPOINT</h2>
                    <div>
                    <form method="POST" id="post-form2">
                        {% csrf_token %}
                        {% for field in roulette_form.hidden_fields %}
                            {{ field }}
                        {% endfor %}
                        {% for field in roulette_form.visible_fields %}
                        <!-- Default checked -->
                             {% if field.auto_id in trigger_fields and field|is_checkbox %}
                                  <div class="form-group form-check custom-control custom-switch" style="display:none" id="{{ field.auto_id }}_trigger_div">
                                    {{ field }}
                                    <label class="custom-control-label" for="{{ field.auto_id }}">{{ field.label }}</label>
                                    <small id="{{ field.auto_id }}_sm" class="form-text text-muted" style="margin-top:-2px;">{{ field.help_text }}</small>
                                </div>
                             {% elif field.auto_id in trigger_fields %}
                                <div class="form-group" style="display:none" id="{{ field.auto_id }}_trigger_div">
                                    <label class="form-check-label"  >{{ field.label }} <span class="trip-value">{{ field.value }}</span>
                                    </label>
                                    <small class="form-text text-muted" style="margin-top:-2px;">{{ field.help_text }}</small>
                                    {{ field }}
                                </div>
                            {% elif field.label == 'Begin here' %}
                                <div class="form-group">
                                    <label class="form-check-label">{{ field.label }}</label>
                                    {{ field }}
                                    <small id="{{ field.label }}_sm" class="form-text text-muted">{{ field.help_text }}</small>
                                    <br>
                                    <button class="btn btn-outline-light btn-sm btn-check" type="button" id="customize-button">CUSTOMIZED</button>
                                    <button class="btn active btn-outline-light btn-sm btn-check" type="button" id="random-button" autofocus>RANDOM</button>

                                </div>
                            {% else %}
                                <div class="form-group">
                                    <label class="form-check-label">{{ field.label }}</label>
                                    {{ field }}
                                    <small id="{{ field.label }}_sm" class="form-text text-muted">{{ field.help_text }}</small>
                                </div>
                            {% endif %}
                        {% endfor %}

                        <div class="form-group">
<!--                            <button class="btn btn-secondary" type="button" id="customize-button">CUSTOMIZE TRIP</button>-->

                            <p class="text-left main-text fl-yellow" style="font-family: 'Roboto Mono', monospace;width: 90%;padding-top: 15px;">Press the BIG BUTTON to generate your uniq <span id="span_journey_type" style="display: inline-block; border: 1px solid white; display: inline-block;border: 1px solid white;padding: 0 6px 0 6px;border-radius: 0.25rem">random</span> journey</p>
                            <button class="btn btn-lg btn-primary" type="sumbit">Generate route</button>
                        </div>

                        </form>
                        <button class="btn btn-light" style="display:none" type="button" id='journey-share-button'>
                            Share
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
                              <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/>
                            </svg>
                        </button>

                    </div>


                </div>
<!--                                    <div class="mx-auto" style="width: 80%;">-->
<!--                                        {% include "sign.html"%}-->
<!--                                    </div>-->
            </div>

        </div>
    </div>
</body>
<script async defer src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&types=regions&language=en&key=AIzaSyC1bv4VSX5EqyfQ5j4GM5Cpwi4wh2pjKwQ&callback=initialize"></script>
<script src="{% static '/assets/js/geo.js' %}"></script>
<script>
// Получаем ссылку на кнопку по ее id
var customizeButton = document.getElementById('customize-button');
var randomButton = document.getElementById('random-button');
var spanJourneyType = document.getElementById('span_journey_type');

// Получаем ссылку на форму по ее id
var postForm = document.getElementById('post-form2');

// Получаем ссылки на все элементы внутри формы с их id
var idRandomElement = postForm.querySelector('#id_random');
var idRoundsElement = postForm.querySelector('#id_rounds_trigger_div');
var idCitySizeElement = postForm.querySelector('#id_citySize_trigger_div');
var idRadiusElement = postForm.querySelector('#id_radius_trigger_div');
var idTypeElement = postForm.querySelector('#id_type_trigger_div');
var idLocalElement = postForm.querySelector('#id_local_trigger_div');

// Назначаем обработчик события click на кнопку
randomButton.addEventListener('click', function() {
    // Получаем текущее значение атрибута "value" для каждого элемента
    var currentValueRandom = idRandomElement.value;
    var currentValueRounds = idRoundsElement.style.display;
    var currentValueCitySize = idCitySizeElement.style.display;
    var currentValueRadius = idRadiusElement.style.display;
    var currentValueLocal = idLocalElement.style.display;

    randomButton.classList.add('active');
    spanJourneyType.innerHTML = 'random'
    customizeButton.classList.remove('active');
    idRandomElement.value = 'true'
    idRoundsElement.style.display = 'none';
    idCitySizeElement.style.display = 'none';
    idRadiusElement.style.display = 'none';
    idLocalElement.style.display = 'none';
});

customizeButton.addEventListener('click', function() {
    // Получаем текущее значение атрибута "value" для каждого элемента
    var currentValueRandom = idRandomElement.value;
    var currentValueRounds = idRoundsElement.style.display;
    var currentValueCitySize = idCitySizeElement.style.display;
    var currentValueRadius = idRadiusElement.style.display;
    var currentValueLocal = idLocalElement.style.display;

    spanJourneyType.innerHTML = 'customized'
    customizeButton.classList.add('active');
    randomButton.classList.remove('active');
    idRandomElement.value = 'false';
    idRoundsElement.style.display = 'block';
    idCitySizeElement.style.display = 'block';
    idRadiusElement.style.display = 'block';
    idLocalElement.style.display = 'block';
});



function custom_toggle() {
    console.log('togle');
}


function updateValue(inputElement) {
    var labelElement = inputElement.parentElement; // Находим родительский элемент
    var smallElement = labelElement.querySelector('span'); // Находим первый элемент <small> внутри родительского элемента
    if (smallElement && inputElement.getAttribute('name') === 'citySize') {
        var value = parseInt(inputElement.value);
        var sizeLabels = ['XS', 'S', 'M', 'L'];
        smallElement.textContent = sizeLabels[value];
    } else {
        // В случае других ползунков, просто отображаем числовое значение
        if (smallElement) {
            smallElement.textContent = inputElement.value;
        }
    }
}

    function toggleParameterText(inputElement) {
    var parent = inputElement.parentElement; // Находим родительский элемент
    var smallElement = parent.querySelector('small'); // Находим первый элемент <small> внутри родительского элемента
    var labelElement = parent.querySelector('label');
        if (inputElement.checked) {
            labelElement.innerHTML = 'Only country of startpoint'
            smallElement.innerHTML = "Now restrict the search to the country of startpoint";
        } else {
            labelElement.innerHTML = 'Any country'
            smallElement.innerHTML = "Now allow the search outside the country of startpoint";
        }
    }

const shareButton = document.getElementById("journey-share-button");
shareButton.addEventListener("click", (e) => {
  if (navigator.share) {
    navigator.share({
        title: 'Web Share API Draft',
        text: 'Take a look at this spec!',
        url: 'https://wicg.github.io/web-share/#share-method',
      })
      .then(() => console.log('Successful share'))
      .catch((error) => console.log('Error sharing', error));
  } else {
    // Копирование URL в буфер обмена
    const urlToCopy = 'https://wicg.github.io/web-share/#share-method';
    navigator.clipboard.writeText(urlToCopy)
      .then(() => {
        console.log('URL скопирован в буфер обмена: ', urlToCopy);
        // Уведомление о копировании URL
        alert('URL скопирован в буфер обмена: ' + urlToCopy);
      })
      .catch((error) => {
        console.error('Ошибка копирования в буфер обмена: ', error);
        // Уведомление об ошибке копирования
        alert('Ошибка копирования в буфер обмена. Пожалуйста, скопируйте URL вручную.');
      });
  }
});

</script>

{% endblock %}
